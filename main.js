(()=>{"use strict";var e="https://nomoreparties.co/v1/plus-cohort-5",t={authorization:"c7ce723e-eaab-417b-b741-f3f9269dcb44","Content-Type":"application/json"},n=".profile__avatar-cover",o=".popup__button-submit",r="popup_opened",c="photo-grid__like-button_active",i="profile__avatar-cover_active",a={};function u(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var l=function(e){for(var t in e)a[t]=e[t]},s=document.querySelector(".profile__avatar-wraper"),p=s.querySelector(n),d=s.querySelector(".profile__avatar"),_=document.querySelector(".profile__name"),f=document.querySelector(".profile__description");function v(e){d.src=e.avatar,d.alt=e.name,_.textContent=e.name,f.textContent=e.about}var m=document.querySelector(".card__template").content,h=document.querySelector(".photo-grid__items");function y(e,t){e.querySelector(".photo-grid__count-like").textContent=t}function S(e){e.classList.add(c)}function q(n){var o=m.querySelector(".photo-grid__item").cloneNode(!0),r=o.querySelector(".photo-grid__image");o.id=n._id,r.src=n.link,r.alt="Изображение ".concat(n.name),o.querySelector(".photo-grid__image-title").textContent=n.name;var i=o.querySelector(".photo-grid__like-button");if(n.likes.forEach((function(e){e._id===a._id&&S(i)})),i.addEventListener("click",(function(){return n=o,void((r=i).classList.contains(c)?function(n,o){var r,i;(r=n,i=t,fetch("".concat(e,"/cards/likes/").concat(r.id),{method:"DELETE",headers:i}).then(u)).then((function(e){y(n,e.likes.length),function(e){e.classList.remove(c)}(o)})).catch((function(e){console.log(e)}))}(n,r):function(n,o){var r,c;(r=n,c=t,fetch("".concat(e,"/cards/likes/").concat(r.id),{method:"PUT",headers:c}).then(u)).then((function(e){y(n,e.likes.length),S(o)})).catch((function(e){console.log(e)}))}(n,r));var n,r})),y(o,n.likes.length),n.owner._id===a._id){var l=o.querySelector(".photo-grid__delete-button");l.classList.add("photo-grid__delete-button_active"),l.addEventListener("click",(function(o){var r;(function(n){var o=t;return fetch("".concat(e,"/cards/").concat(n),{method:"DELETE",headers:o}).then(u)})(r=n._id).then((function(e){var t;t=r,document.getElementById("".concat(t)).remove()})).catch((function(e){console.log(e)}))}))}return r.addEventListener("click",(function(e){return t={link:n.link,name:n.name},Z.setAttribute("src",t.link),Z.setAttribute("alt","Изображение ".concat(t.name)),$.textContent=t.name,void te(Y);var t})),o}var b,E,L,g,k,C,x,A,T,D,w,P=function(e){var t;t=q(e),h.prepend(t)},N=document.querySelectorAll(".popup"),O=document.querySelector(".profile__edit-button"),j=document.querySelector(".popup_type_avatar-edit"),B=j.querySelector(".popup__form_type_avatar-edit"),J=B.querySelector(".popup__input_avatar"),H=B.querySelector(o),z=document.querySelector(".popup_type_profile-edit"),I=document.querySelector(n),M=z.querySelector(".popup__input_profile_name"),U=z.querySelector(".popup__input_profile_description"),F=z.querySelector(".popup__form_type_profile-edit"),G=z.querySelector(o),K=document.querySelector(".profile__add-button"),Q=document.querySelector(".popup_type_add-place"),R=Q.querySelector(".popup__form_type_add-place"),V=R.querySelector(".popup__input_place_name"),W=R.querySelector(".popup__input_place_link"),X=Q.querySelector(o),Y=document.querySelector(".popup_type_view"),Z=Y.querySelector(".popup__image"),$=Y.querySelector(".popup__caption");function ee(e){if("Escape"===e.key){var t=document.querySelector(".".concat(r));t&&ne(t)}}function te(e){e.classList.add(r),document.addEventListener("keydown",ee)}function ne(e){e.classList.remove(r),document.removeEventListener("keydown",ee)}function oe(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.removeAttribute("disabled"):t.setAttribute("disabled",!0)}(b=t,fetch("".concat(e,"/users/me"),{headers:b}).then(u)).then((function(n){l(n),v(n),function(){var n=t;return fetch("".concat(e,"/cards"),{headers:n}).then(u)}().then((function(e){!function(e){e.forEach((function(e){return P(e)}))}(e)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),s.addEventListener("mouseover",(function(){p.classList.add(i)})),s.addEventListener("mouseout",(function(){p.classList.remove(i)})),O.addEventListener("click",(function(){var e=a;M.value=e.name,U.value=e.about,G.setAttribute("disabled",!0),G.textContent="Сохранить",te(z)})),F.addEventListener("submit",(function(n){var o,r,c;n.preventDefault(),G.textContent="Сохранение...",(o=M.value,r=U.value,c=t,fetch("".concat(e,"/users/me"),{method:"PATCH",headers:c,body:JSON.stringify({name:o,about:r})}).then(u)).then((function(e){l(e),v(e),ne(z)})).catch((function(e){console.log(e)}))})),I.addEventListener("click",(function(){var e=a;J.value=e.avatar,H.setAttribute("disabled",!0),H.textContent="Сохранить",te(j)})),B.addEventListener("submit",(function(n){var o,r;n.preventDefault(),H.textContent="Сохранение...",(o=J.value,r=t,fetch("".concat(e,"/users/me/avatar"),{method:"PATCH",headers:r,body:JSON.stringify({avatar:o})}).then(u)).then((function(e){l(e),v(e),ne(j)})).catch((function(e){console.log(e)}))})),K.addEventListener("click",(function(){return te(Q)})),R.addEventListener("submit",(function(n){n.preventDefault();var o,r,c=V.value,i=W.value;X.textContent="Создание...",(o={name:c,link:i},r=t,fetch("".concat(e,"/cards"),{method:"POST",headers:r,body:JSON.stringify({name:o.name,link:o.link})}).then(u)).then((function(e){P(e),ne(Q),R.reset(),X.setAttribute("disabled",!0),X.textContent="Создать"})).catch((function(e){console.log(e)}))})),N.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains(r)&&ne(e),t.target.classList.contains("popup__button-close")&&ne(e)}))})),L=(E={formSelector:".popup__form",formSectionSelector:".popup__form-section",inputSelector:".popup__input-text",inputTextError:".popup__input-text-error",submitButtonSelector:".popup__button-submit",inputErrorClass:"popup__input-text_color_error",errorClass:"popup__input-text-error_active"}).formSelector,g=E.formSectionSelector,k=E.inputSelector,C=E.inputTextError,x=E.submitButtonSelector,A=E.inputErrorClass,T=E.errorClass,D=Array.from(document.querySelectorAll(L)),w=function(e){e.preventDefault()},D.forEach((function(e){e.addEventListener("submit",w),function(e,t,n,o,r,c,i){var a=Array.from(t.querySelectorAll(o)),u=t.querySelector(r);oe(a,u);var l=function(t){!function(e,t,n,o,r){t.validity.valid?function(e,t,n,o,r){var c=t.closest(e).querySelector(n);t.classList.remove(o),c.classList.remove(r),c.textContent=""}(e,t,n,o,r):function(e,t,n,o,r,c){var i=t.closest(e).querySelector(n);t.classList.add(r),i.classList.add(c),i.textContent=o}(e,t,n,t.validationMessage,o,r)}(e,t.target,n,c,i),oe(a,u)};a.forEach((function(e){e.addEventListener("input",l)}))}(g,e,C,k,x,A,T)}))})();