(()=>{"use strict";var t="https://nomoreparties.co/v1/plus-cohort-5",e={authorization:"c7ce723e-eaab-417b-b741-f3f9269dcb44","Content-Type":"application/json"},n=".profile__avatar-cover",o=".popup__button-submit",r="popup_opened",c="photo-grid__like-button_active",i="profile__avatar-cover_active",u=document.querySelector(".profile__avatar-wraper"),a=u.querySelector(n),s=u.querySelector(".profile__avatar"),l=document.querySelector(".profile__name"),p=document.querySelector(".profile__description");function d(t){s.src=t.avatar,s.alt=t.name,l.textContent=t.name,p.textContent=t.about}var f=document.querySelectorAll(".popup"),_=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_avatar-edit"),m=v.querySelector(".popup__form_type_avatar-edit"),h=m.querySelector(".popup__input_avatar"),y=m.querySelector(o),S=document.querySelector(".popup_type_profile-edit"),q=document.querySelector(n),b=S.querySelector(".popup__input_profile_name"),k=S.querySelector(".popup__input_profile_description"),E=S.querySelector(".popup__form_type_profile-edit"),L=S.querySelector(o),g=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_add-place"),x=C.querySelector(".popup__form_type_add-place"),j=x.querySelector(".popup__input_place_name"),A=x.querySelector(".popup__input_place_link"),P=C.querySelector(o),T=document.querySelector(".popup_type_view"),D=T.querySelector(".popup__image"),w=T.querySelector(".popup__caption");function N(t){if("Escape"===t.key){var e=document.querySelector(".".concat(r));e&&B(e)}}function O(t){t.classList.add(r),document.addEventListener("keydown",N)}function B(t){t.classList.remove(r),document.removeEventListener("keydown",N)}var J=document.querySelector(".card__template").content,H=document.querySelector(".photo-grid__items");function z(t){t.classList.add(c)}function I(t,e){t.querySelector(".photo-grid__count-like").textContent=e}function M(n){var o=J.querySelector(".photo-grid__item").cloneNode(!0),r=o.querySelector(".photo-grid__image");o.id=n._id,r.src=n.link,r.alt="Изображение ".concat(n.name),o.querySelector(".photo-grid__image-title").textContent=n.name;var i=o.querySelector(".photo-grid__like-button");if(n.likes.forEach((function(t){t._id===tt._id&&z(i)})),i.addEventListener("click",(function(){return function(n,o){var r,i,u;o.classList.contains(c)?(r=n,i=o,u=e,fetch("".concat(t,"/cards/likes/").concat(r.id),{method:"DELETE",headers:u}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){I(r,t.likes.length),function(t){t.classList.remove(c)}(i)})).catch((function(t){console.log(t)}))):function(n,o){var r=e;fetch("".concat(t,"/cards/likes/").concat(n.id),{method:"PUT",headers:r}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){I(n,t.likes.length),z(o)})).catch((function(t){console.log(t)}))}(n,o)}(o,i)})),I(o,n.likes.length),n.owner._id===tt._id){var u=o.querySelector(".photo-grid__delete-button");u.classList.add("photo-grid__delete-button_active"),u.addEventListener("click",(function(o){return r=n._id,c=e,fetch("".concat(t,"/cards/").concat(r),{method:"DELETE",headers:c}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){var e;e=r,document.getElementById("".concat(e)).remove()})).catch((function(t){console.log(t)}));var r,c}))}return r.addEventListener("click",(function(t){return e={link:n.link,name:n.name},D.setAttribute("src",e.link),D.setAttribute("alt","Изображение ".concat(e.name)),w.textContent=e.name,void O(T);var e})),o}var U,F,G,K,Q,R,V,W,X,Y,Z,$=function(t){var e;e=M(t),H.prepend(e)},tt={},et=function(n,o){var r=e;return fetch("".concat(t,"/users/me"),{method:"PATCH",headers:r,body:JSON.stringify({name:n,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){rt(t),d(t)})).catch((function(t){console.log(t)}))},nt=function(n){var o=e;return fetch("".concat(t,"/cards"),{method:"POST",headers:o,body:JSON.stringify({name:n.name,link:n.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){$(t)})).catch((function(t){console.log(t)}))},ot=function(n){var o=e;return fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:o,body:JSON.stringify({avatar:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){rt(t),d(t)})).catch((function(t){console.log(t)}))},rt=function(t){for(var e in t)tt[e]=t[e]};function ct(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.removeAttribute("disabled"):e.setAttribute("disabled",!0)}U=e,fetch("".concat(t,"/users/me"),{headers:U}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(n){rt(n),d(n),function(){var n=e;fetch("".concat(t,"/cards"),{headers:n}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){!function(t){t.forEach((function(t){return $(t)}))}(t)})).catch((function(t){console.log(t)}))}()})).catch((function(t){console.log(t)})),u.addEventListener("mouseover",(function(){a.classList.add(i)})),u.addEventListener("mouseout",(function(){a.classList.remove(i)})),_.addEventListener("click",(function(){var t=tt;b.value=t.name,k.value=t.about,L.setAttribute("disabled",!0),L.textContent="Сохранить",O(S)})),E.addEventListener("submit",(function(t){t.preventDefault(),L.textContent="Сохранение...",et(b.value,k.value),B(S)})),q.addEventListener("click",(function(){var t=tt;h.value=t.avatar,y.setAttribute("disabled",!0),y.textContent="Сохранить",O(v)})),m.addEventListener("submit",(function(t){t.preventDefault(),y.textContent="Сохранение...",ot(h.value),B(v)})),g.addEventListener("click",(function(){return O(C)})),x.addEventListener("submit",(function(t){t.preventDefault();var e=j.value,n=A.value;P.textContent="Создание...",nt({name:e,link:n}),B(C),j.value="",A.value="",P.setAttribute("disabled",!0),P.textContent="Создать"})),f.forEach((function(t){t.addEventListener("click",(function(e){e.target.classList.contains(r)&&B(t),e.target.classList.contains("popup__button-close")&&B(t)}))})),G=(F={formSelector:".popup__form",formSectionSelector:".popup__form-section",inputSelector:".popup__input-text",inputTextError:".popup__input-text-error",submitButtonSelector:".popup__button-submit",inputErrorClass:"popup__input-text_color_error",errorClass:"popup__input-text-error_active"}).formSelector,K=F.formSectionSelector,Q=F.inputSelector,R=F.inputTextError,V=F.submitButtonSelector,W=F.inputErrorClass,X=F.errorClass,Y=Array.from(document.querySelectorAll(G)),Z=function(t){t.preventDefault()},Y.forEach((function(t){t.addEventListener("submit",Z),function(t,e,n,o,r,c,i){var u=Array.from(e.querySelectorAll(o)),a=e.querySelector(r);ct(u,a);var s=function(e){!function(t,e,n,o,r){e.validity.valid?function(t,e,n,o,r){var c=e.closest(t).querySelector(n);e.classList.remove(o),c.classList.remove(r),c.textContent=""}(t,e,n,o,r):function(t,e,n,o,r,c){var i=e.closest(t).querySelector(n);e.classList.add(r),i.classList.add(c),i.textContent=o}(t,e,n,e.validationMessage,o,r)}(t,e.target,n,c,i),ct(u,a)};u.forEach((function(t){t.addEventListener("input",s)}))}(K,t,R,Q,V,W,X)}))})();